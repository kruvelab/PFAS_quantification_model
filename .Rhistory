datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbind = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rbind(old_training_data)
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
datarbindedit$newcol <- vec
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
datarbindedit$newcol <- vector(40)
datarbindedit = datarbind%>%
inner_join(old_training_data,datarbindedit)
datarbindedit = datarbind%>%
inner_join(old_training_data,datarbind)
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)
View(datarbindedit)
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic
name = Compound)
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic%>%
name = Compound)
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename(name = Compound)
View(datarbind)
View(old_training_data)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate")
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = log(IE),
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")#placeholder
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = log(IE, 10),
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")#placeholder
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = log(IE,base = 10),
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")#placeholder
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = log10(IE),
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")#placeholder
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")#placeholder
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")%>%
select(-IE)
old_training_data = old_training_data%>%
select(-pH.aq.)
data = data %>%
mutate(
RT = as.numeric(RT),
area_IC = Area*IC,
organic_modifier = organic_modifier,
pH.aq. = pH.aq.,
NH4 = 1, #1 if the buffer contains NH造 ions , 0 if not.
organic = organicpercentage(eluent,RT),
viscosity = viscosity(organic,organic_modifier),
surface_tension = surfacetension(organic,organic_modifier),
polarity_index = polarityindex(organic,organic_modifier))
training = data %>%
filter(!is.na(SMILES)) %>%
filter(`Theoretical Amt` != "N/F") %>%
filter(`Theoretical Amt` != "N/A") %>%
mutate(`Theoretical Amt` = as.numeric(`Theoretical Amt`)) %>%
mutate(`Theoretical Amt` = `Theoretical Amt`/MW) #correct with MW
#print(training %>% select(Compound) %>% unique(), n=40)
ggplot(data = training) +
geom_point(mapping = aes(x = `Theoretical Amt`,
y = area_IC)) +
facet_wrap(~Compound, scales = "free") +
scale_x_log10() +
scale_y_log10()
training = training %>%
group_by(SMILES) %>%
mutate(slope = linear_regression(area_IC, `Theoretical Amt`)$slope) %>%
ungroup()
#converting slopes to logIE
filename = "data/IE_training_data/190714_negative_model_logIE_data.csv"
old_training_data = read_delim(filename,
delim = ";",
col_names = TRUE)
old_training_data = old_training_data%>%
select(-pH.aq.)
old_training_data_filtered = old_training_data %>%
filter(organic_modifier=="MeCN")%>%
filter(name=="perfluorooctanesulfonic acid")%>%
filter(additive=="ammonium acetate")%>%
filter(pH_aq==7.8)
IEPFOSvalue = old_training_data_filtered$logIE
Anchor_slope = training %>%
select(Compound,slope) %>%
unique()%>%
filter(Compound == "PFOS")
#makes slopePFOS a value
slopePFOS <- Anchor_slope$slope
training = training %>%
mutate(RIE =slope/slopePFOS )%>%
mutate(RIE =log(RIE))%>%
mutate(IE =RIE + IEPFOSvalue)%>%
select(Compound,3:6,1452:1463, IE,slope,everything(),-RIE)
datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename(name = Compound)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")%>%
select(-IE)
data = data %>%
mutate(
RT = as.numeric(RT),
area_IC = Area*IC,
organic_modifier = organic_modifier,
pH.aq. = pH.aq.,
NH4 = 1, #1 if the buffer contains NH造 ions , 0 if not.
organic = organicpercentage(eluent,RT),
viscosity = viscosity(organic,organic_modifier),
surface_tension = surfacetension(organic,organic_modifier),
polarity_index = polarityindex(organic,organic_modifier))
training = data %>%
filter(!is.na(SMILES)) %>%
filter(`Theoretical Amt` != "N/F") %>%
filter(`Theoretical Amt` != "N/A") %>%
mutate(`Theoretical Amt` = as.numeric(`Theoretical Amt`)) %>%
mutate(`Theoretical Amt` = `Theoretical Amt`/MW) #correct with MW
#print(training %>% select(Compound) %>% unique(), n=40)
ggplot(data = training) +
geom_point(mapping = aes(x = `Theoretical Amt`,
y = area_IC)) +
facet_wrap(~Compound, scales = "free") +
scale_x_log10() +
scale_y_log10()
training = training %>%
group_by(SMILES) %>%
mutate(slope = linear_regression(area_IC, `Theoretical Amt`)$slope) %>%
ungroup()
#converting slopes to logIE
filename = "data/IE_training_data/190714_negative_model_logIE_data.csv"
old_training_data = read_delim(filename,
delim = ";",
col_names = TRUE)
old_training_data = old_training_data%>%
select(-pH_aq.)
old_training_data_filtered = old_training_data %>%
filter(organic_modifier=="MeCN")%>%
filter(name=="perfluorooctanesulfonic acid")%>%
filter(additive=="ammonium acetate")%>%
filter(pH_aq==7.8)
IEPFOSvalue = old_training_data_filtered$logIE
Anchor_slope = training %>%
select(Compound,slope) %>%
unique()%>%
filter(Compound == "PFOS")
#makes slopePFOS a value
slopePFOS <- Anchor_slope$slope
training = training %>%
mutate(RIE =slope/slopePFOS )%>%
mutate(RIE =log(RIE))%>%
mutate(IE =RIE + IEPFOSvalue)%>%
select(Compound,3:6,1452:1463, IE,slope,everything(),-RIE)
datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename(name = Compound)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")%>%#placeholder
select(-IE)
library(tidyverse)
library(plotly)
setwd("~/GitHub/PFOA_semi_quant")
source("code/PaDEL_descs_calculator.R")
source("code/reading_excel.R")
source("code/compound_eluent.R")
#setwd("C:/Users/annel/Nextcloud/mudeli script ja failid/PFOA_semi_quant/PFOA_semi_quant")
#regressor----
regressor = readRDS("regressors/regressor_neg_new.rds")
descs_names = readRDS("regressors/negative_descs.rds")
#lcms data ----
filename = "data/Batch 1 Semi Quant w frag.xlsx"
Orbitrap_dataset_raw = read_excel_allsheets(filename)
Orbitrap_dataset_raw = Orbitrap_dataset_raw %>%
na.omit(Area) %>%
filter(Area != "N/F") %>%
mutate(Area = as.numeric(Area))
#Orbitrap_dataset_raw %>% select(Compound) %>% unique()
Orbitrap_dataset_raw = Orbitrap_dataset_raw %>%
group_by(Compound) %>%
mutate(`Theoretical Amt`=case_when(
Filename=="2020071205-cal21"~mean(`Theoretical Amt`[Filename=="2020071205-cal22"]),
TRUE~`Theoretical Amt`
))%>%ungroup()
#smiles and descriptors----
SMILES_data = read_delim("data/Smiles_for_Target_PFAS_semicolon.csv",
delim = ";",
col_names = TRUE)
#how many unique SMILES are there
#SMILES_data %>% select(SMILES) %>% unique()
SMILES_data = SMILES_data %>%
rename(Compound = ID) %>%
select(Compound, SMILES, Class) %>%
na.omit()
descs_calc_PFOA = PaDEL_original(SMILES_data)
write_delim(descs_calc_PFOA,
"data/descs_calc.csv",
delim = ",")
#descs_calc_PFOA = read_delim("data/descs_calc.csv",
#delim = ",",
#col_names = TRUE)
descs_calc_PFOA = descs_calc_PFOA %>%
select(Compound, SMILES,
#all_of(descs_names),
everything())
#check number of unique analytes
#descs_calc_PFOA %>% select(SMILES) %>% unique()
descs_calc_PFOA = descs_calc_PFOA %>%
group_by(SMILES) %>%
mutate(IC = isotopedistribution(SMILES),
MW = molecularmass(SMILES)) %>%
ungroup()
#eluent---
eluent = read_delim("data/eluent.csv",
delim = ",",
col_names = TRUE)
organic_modifier = "MeCN"
pH.aq. = 7.0
data = Orbitrap_dataset_raw %>%
left_join(descs_calc_PFOA)
data = data %>%
mutate(
RT = as.numeric(RT),
area_IC = Area*IC,
organic_modifier = organic_modifier,
pH.aq. = pH.aq.,
NH4 = 1, #1 if the buffer contains NH造 ions , 0 if not.
organic = organicpercentage(eluent,RT),
viscosity = viscosity(organic,organic_modifier),
surface_tension = surfacetension(organic,organic_modifier),
polarity_index = polarityindex(organic,organic_modifier))
training = data %>%
filter(!is.na(SMILES)) %>%
filter(`Theoretical Amt` != "N/F") %>%
filter(`Theoretical Amt` != "N/A") %>%
mutate(`Theoretical Amt` = as.numeric(`Theoretical Amt`)) %>%
mutate(`Theoretical Amt` = `Theoretical Amt`/MW) #correct with MW
#print(training %>% select(Compound) %>% unique(), n=40)
ggplot(data = training) +
geom_point(mapping = aes(x = `Theoretical Amt`,
y = area_IC)) +
facet_wrap(~Compound, scales = "free") +
scale_x_log10() +
scale_y_log10()
training = training %>%
group_by(SMILES) %>%
mutate(slope = linear_regression(area_IC, `Theoretical Amt`)$slope) %>%
ungroup()
#converting slopes to logIE
filename = "data/IE_training_data/190714_negative_model_logIE_data.csv"
old_training_data = read_delim(filename,
delim = ";",
col_names = TRUE)
old_training_data = old_training_data%>%
select(-pH_aq.)
old_training_data_filtered = old_training_data %>%
filter(organic_modifier=="MeCN")%>%
filter(name=="perfluorooctanesulfonic acid")%>%
filter(additive=="ammonium acetate")%>%
filter(pH_aq==7.8)
IEPFOSvalue = old_training_data_filtered$logIE
Anchor_slope = training %>%
select(Compound,slope) %>%
unique()%>%
filter(Compound == "PFOS")
#makes slopePFOS a value
slopePFOS <- Anchor_slope$slope
training = training %>%
mutate(RIE =slope/slopePFOS )%>%
mutate(RIE =log(RIE))%>%
mutate(IE =RIE + IEPFOSvalue)%>%
select(Compound,3:6,1452:1463, IE,slope,everything(),-RIE)
datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename(name = Compound)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")%>%#placeholder
select(-IE)
colorder = colnames(datarbindedit)
old_training_data = old_training_data[,colorder]
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename("name" = Compound)
datarbindedit = datarbind%>%
mutate(additive = "ammoniumacetate",
additive_concentration_mM = 2,
logIE = IE,
instrument = "Orbitrap",
source = "ESI",
solvent = "MeCN",#placeholder
SPLIT = "TRUE")%>%#placeholder
select(-IE)
old_training_data = old_training_data%>%
select(-pH_aq., -logIE_pred, -error_abs)
old_training_data_filtered = old_training_data %>%
filter(organic_modifier=="MeCN")%>%
filter(name=="perfluorooctanesulfonic acid")%>%
filter(additive=="ammonium acetate")%>%
filter(pH_aq==7.8)
IEPFOSvalue = old_training_data_filtered$logIE
Anchor_slope = training %>%
select(Compound,slope) %>%
unique()%>%
filter(Compound == "PFOS")
#makes slopePFOS a value
slopePFOS <- Anchor_slope$slope
training = training %>%
mutate(RIE =slope/slopePFOS )%>%
mutate(RIE =log(RIE))%>%
mutate(IE =RIE + IEPFOSvalue)%>%
select(Compound,3:6,1452:1463, IE,slope,everything(),-RIE)
datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename("name" = Compound)%>%
select(-RT)
data = data %>%
mutate(
RT = as.numeric(RT),
area_IC = Area*IC,
organic_modifier = organic_modifier,
pH.aq. = pH.aq.,
NH4 = 1, #1 if the buffer contains NH造 ions , 0 if not.
organic = organicpercentage(eluent,RT),
viscosity = viscosity(organic,organic_modifier),
surface_tension = surfacetension(organic,organic_modifier),
polarity_index = polarityindex(organic,organic_modifier))
training = data %>%
filter(!is.na(SMILES)) %>%
filter(`Theoretical Amt` != "N/F") %>%
filter(`Theoretical Amt` != "N/A") %>%
mutate(`Theoretical Amt` = as.numeric(`Theoretical Amt`)) %>%
mutate(`Theoretical Amt` = `Theoretical Amt`/MW) #correct with MW
#print(training %>% select(Compound) %>% unique(), n=40)
ggplot(data = training) +
geom_point(mapping = aes(x = `Theoretical Amt`,
y = area_IC)) +
facet_wrap(~Compound, scales = "free") +
scale_x_log10() +
scale_y_log10()
training = training %>%
group_by(SMILES) %>%
mutate(slope = linear_regression(area_IC, `Theoretical Amt`)$slope) %>%
ungroup()
#converting slopes to logIE
filename = "data/IE_training_data/190714_negative_model_logIE_data.csv"
old_training_data = read_delim(filename,
delim = ";",
col_names = TRUE)
old_training_data = old_training_data%>%
select(-pH_aq., -logIE_pred, -error_abs)
old_training_data_filtered = old_training_data %>%
filter(organic_modifier=="MeCN")%>%
filter(name=="perfluorooctanesulfonic acid")%>%
filter(additive=="ammonium acetate")%>%
filter(pH_aq==7.8)
IEPFOSvalue = old_training_data_filtered$logIE
Anchor_slope = training %>%
select(Compound,slope) %>%
unique()%>%
filter(Compound == "PFOS")
#makes slopePFOS a value
slopePFOS <- Anchor_slope$slope
training = training %>%
mutate(RIE =slope/slopePFOS )%>%
mutate(RIE =log(RIE))%>%
mutate(IE =RIE + IEPFOSvalue)%>%
select(Compound,3:6,1452:1463, IE,slope,everything(),-RIE)
datarbind = training%>%
select(1:17,-"Theoretical Amt", -Area, -area_IC, -IC, -Filename)%>%
unique()%>%
group_by(Compound) %>%
mutate(RT=mean(RT))%>%
ungroup()
datarbind = datarbind%>%
group_by(Compound)%>%
mutate(polarity_index=mean(polarity_index))%>%
mutate(organic=mean(organic))%>%
mutate(viscosity=mean(viscosity))%>%
mutate(surface_tension=mean(surface_tension))%>%
ungroup()%>%
unique()
datarbindedit = datarbind%>%
rename(organic_modifier_percentage = organic)%>%
rename("name" = Compound)%>%
select(-RT)
